<!DOCTYPE html>
<html>
  <head>
    <style type="text/css">
      html, body { height: 100%; margin: 0; padding: 0; }
      #map { height: 75%; width: auto;}
    </style>
  </head>

  <body>
    <div id="map"></div>
    
    <script type="text/javascript">

	    var map;

	    function initMap() {
	      map = new google.maps.Map(document.getElementById('map'), {
	        center: {lat:40.73, lng:-73.99},
	        zoom: 12
	      });


	   <% @events.each do | event | %>
	    var marker = new google.maps.Marker({
  			 position: {lat:<%=event['venue']['latitude']%>, lng:<%=event['venue']['longitude']%>},
			   map: map,
			   title: '<%=event['venue']['name']%>'
			   // url: '/<%=event[:id]%>'

			 });
	        google.maps.event.addListener(marker, 'click', function() {
    	window.location.href = this.url;
			});
	   
			<%end%>

	    }

	  </script>
	  <div class="eventlist">

			<h1>List of Nearby Events</h1>
			<% @events.each do |event| %>
			<a href="/events/show/<%=event['venue']['city']%>/<%=event['venue']['region']%>/<%=event['id']%>"><ul>
				<li>Where: <%=event['venue']['name']%> , <%=event['venue']['region']%></li>
        <% date = event['datetime'].gsub!("T", " ")
    the_date = DateTime.parse(date).strftime('%A %B %d, %I:%M %p %Y') %>
				<li>When: <%= the_date%></li>
				<li>
					Who:
					<ul>
					<%event['artists'].each do |artist| %>
						<li><img src="<%=artist['url']%>"><%=artist['name']%></li>
						<%end%>
					</ul>
				</li>
			</ul></a>
			<%end%>

	  </div><!--eventlist-->


    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GMAP_ID']%>&callback=initMap">
    </script>
  </body>
</html>